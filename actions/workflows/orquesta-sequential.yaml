version: 1.0
  
description: A basic sequential workflow.

input:
  - name

vars:
  - greeting: null
  - host_ip: null
  - host_name: null
  - service: null
  - key: true
  - hosts: null
  
output:
  - greeting: <% ctx().greeting %>

tasks:
  task1:
    action: example.example_action_1
    input: 
      name: <% ctx().name %>
    next:
      - when: <% succeeded() %>
        publish: 
          greeting=<% result().stdout %>
          host_ip=<% result().result %>
        do: task2
      - when: <% failed() %>
        publish:
          - greeting: <% ctx("greeting") %>, <% result().stdout %>
        do:
          - task5
  task2:
    action: example.example_action_2
    input: 
      name2: <% ctx("host_ip") %>
      key: <% ctx("key") %>
    next:
      - when: <% succeeded() %>
        publish: 
          greeting=<% result().stdout %>
          hosts=<% result().result %>
        do: View_container_status
      - when: <% failed() %> 
        publish:
          message="Example"
          key=false
        do:
          - task2
  View_container_status:
    action: core.remote
    input: 
      hosts: <% ctx("hosts") %>
      username: 'root'
      private_key: '/home/stanley/.ssh/id_rsa'
      cmd: 'systemctl is-enabled docker'
    next:
      - when: <% result(0)['stdout'] %>
        publish: 
          greeting=<% result().stdout %>
        do: task3
      - when: <% failed() %>
        publish:
          - greeting: <% ctx("greeting") %>, <% result().stdout %>
        do:
          - task5
  task3:
    action: core.echo
    input: 
      message: <% ctx("greeting") %>
    next:
      - when: <% succeeded() %>
        publish:
          - greeting: <% ctx("greeting") %>, <% result().stdout %>
        do:
          - task4
  task4:
    action: core.echo message=<% ctx('greeting') %>
    next:
      - when: <% succeeded() %>
        publish: greeting=<% result().stdout %>
  task5:
    action: core.echo message="ERROR"
    next:
      - when: <% succeeded() %>
        publish: greeting=<% result().stdout %>
